===== TREE STRUCTURE =====
.
./dump.txt
./LICENSE
./pyproject.toml
./README.md
./treedump
./treedump/cli.py
./treedump/__init__.py
./treedump/__pycache__
./treedump/__pycache__/cli.cpython-310.pyc
./treedump/__pycache__/__init__.cpython-310.pyc
./treedump.egg-info
./treedump.egg-info/dependency_links.txt
./treedump.egg-info/entry_points.txt
./treedump.egg-info/PKG-INFO
./treedump.egg-info/SOURCES.txt
./treedump.egg-info/top_level.txt

===== END TREE STRUCTURE =====

===== FILE: LICENSE =====
MIT License

Copyright (c) 2025 appfeat

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.

===== END FILE: LICENSE =====

===== FILE: pyproject.toml =====
[build-system]
requires = ["setuptools>=61"]
build-backend = "setuptools.build_meta"

[project]
name = "treedump"
version = "0.1.0"
description = "Dump all text files in a directory tree into a single file"
readme = "README.md"
requires-python = ">=3.9"
authors = [
  { name="Your Name" }
]
dependencies = []

[project.scripts]
treedump = "treedump.cli:main"

===== END FILE: pyproject.toml =====

===== FILE: README.md =====
# treedump

`treedump` walks a directory tree and produces a single text dump containing:

1. The directory tree structure (first)
2. The contents of all **text files** in that tree (second)

Binary files are ignored.  
The output file itself is never re-ingested.

This tool is designed for:
- code review and audits
- LLM context ingestion
- archiving project snapshots
- inspecting unfamiliar repositories

---

## Installation

Install from PyPI:

    pip install treedump

For development or local testing:

    pip install -e .

---

## Basic usage

Run in any directory:

    treedump

This creates `dump.txt` in the current directory.

---

## Output format

The output is structured and deterministic.

Tree structure is always written first, followed by file contents.

Example:

    ===== TREE STRUCTURE =====
    .
    ./src
    ./src/main.py
    ./README.md
    ===== END TREE STRUCTURE =====

    ===== FILE: src/main.py =====
    <file contents>
    ===== END FILE: src/main.py =====

    ===== FILE: README.md =====
    <file contents>
    ===== END FILE: README.md =====

---

## Ignore behavior (important)

### Default behavior

Ignore rules are determined as follows:

1. If a `.gitignore` file exists in the current directory:
   - Only `.gitignore` rules are used
   - Built-in defaults are NOT applied

2. If no `.gitignore` exists:
   - A safe built-in ignore list is used

The built-in ignore list includes:

- version control and tooling directories  
  `.git/`, `__pycache__/`, `venv/`, `.venv/`, `node_modules/`,  
  `.mypy_cache/`, `.pytest_cache/`, `.idea/`, `.vscode/`

- compiled and noisy artifacts  
  `*.pyc`, `*.log`

- secret-bearing files  
  `.env`, `.env.*`, `*.env`  
  `.secrets`, `.secrets.*`  
  `*.key`, `*.pem`, `*.crt`, `*.p12`, `*.keystore`  
  `id_rsa`, `id_ed25519`, `*.pub`  
  `credentials`, `credentials.*`  
  `.aws/`, `.ssh/`

This makes `treedump` safe by default in non-git directories and predictable inside git repositories.

---

## Ignore options

### Disable all ignore rules

    treedump --ignore-off

When this flag is used:
- all ignore rules are disabled
- binary files are still skipped
- the output file is still excluded

Use with care.

---

### Add ignore files

    treedump --ignore .gitignore custom.ignore

Ignore files use simple glob-style patterns.  
Empty lines and comments (`#`) are ignored.

---

### Add ignore patterns inline

    treedump --ignore-pattern "*.sql" "*.db"

Ignore files and inline patterns are additive unless `--ignore-off` is specified.

---

## Other options

### Change output file name

    treedump --output project_dump.txt

---

### Omit tree structure

    treedump --no-tree

Only file contents will be written.

---

## Requirements

- Python 3.9 or newer
- External commands available in PATH:
  - `tree`
  - `file`

These are standard on most Unix-like systems.

---

## Philosophy

`treedump` follows classic Unix principles:

- structure before content
- text-only by default
- explicit behavior over clever inference
- safe defaults with deliberate escape hatches
- boring, predictable output

It intentionally does less than a full indexing or archival system.

---

## License

MIT

===== END FILE: README.md =====

===== FILE: treedump/cli.py =====
#!/usr/bin/env python3
import argparse
import subprocess
from pathlib import Path
import fnmatch

DEFAULT_IGNORE_PATTERNS = [
    # tooling / noise
    ".git/*",
    "__pycache__/*",
    "venv/*",
    ".venv/*",
    "node_modules/*",
    ".mypy_cache/*",
    ".pytest_cache/*",
    ".idea/*",
    ".vscode/*",

    # compiled / logs
    "*.pyc",
    "*.log",

    # secrets / credentials
    ".env",
    ".env.*",
    "*.env",
    ".secrets",
    ".secrets.*",
    "*.key",
    "*.pem",
    "*.crt",
    "*.p12",
    "*.keystore",
    "id_rsa",
    "id_ed25519",
    "*.pub",
    "credentials",
    "credentials.*",
    ".aws/*",
    ".ssh/*",
]

def run(cmd):
    return subprocess.run(
        cmd,
        capture_output=True,
        text=True,
        check=True,
    ).stdout

def is_text_file(path: Path) -> bool:
    try:
        mime = run(["file", "--mime-type", "-b", str(path)]).strip()
        return mime.startswith("text/")
    except Exception:
        return False

def load_ignore_file(path: Path):
    patterns = []
    try:
        for line in path.read_text().splitlines():
            line = line.strip()
            if not line or line.startswith("#"):
                continue
            patterns.append(line)
    except Exception:
        pass
    return patterns

def is_ignored(path: Path, patterns):
    posix_path = path.as_posix()
    for pattern in patterns:
        if fnmatch.fnmatch(posix_path, pattern) or fnmatch.fnmatch(path.name, pattern):
            return True
    return False

def main():
    parser = argparse.ArgumentParser(
        prog="treedump",
        description="Dump all text files in a directory tree into a single file.",
    )
    parser.add_argument(
        "--output",
        default="dump.txt",
        help="output file name (default: dump.txt)",
    )
    parser.add_argument(
        "--no-tree",
        action="store_true",
        help="do not include tree structure at the top of the dump",
    )
    parser.add_argument(
        "--ignore-off",
        action="store_true",
        help="disable all ignore rules (except binary files and output file)",
    )
    parser.add_argument(
        "--ignore",
        nargs="*",
        default=[],
        help="path(s) to ignore pattern files",
    )
    parser.add_argument(
        "--ignore-pattern",
        nargs="*",
        default=[],
        help="additional ignore patterns (glob syntax)",
    )

    args = parser.parse_args()

    root = Path(".").resolve()
    output_path = root / args.output
    gitignore_path = root / ".gitignore"

    # Build ignore patterns
    ignore_patterns = []

    if not args.ignore_off:
        if gitignore_path.exists():
            # Use ONLY .gitignore if present
            ignore_patterns.extend(load_ignore_file(gitignore_path))
        else:
            # Fall back to built-in defaults
            ignore_patterns.extend(DEFAULT_IGNORE_PATTERNS)

        # Add user-provided ignores
        for ignore_file in args.ignore:
            ignore_patterns.extend(load_ignore_file(Path(ignore_file)))

        ignore_patterns.extend(args.ignore_pattern)

    # Clear output
    output_path.write_text("")

    # Generate tree once
    tree_output = run(["tree", "-if", "--noreport", "."])

    # --- Tree structure ---
    if not args.no_tree:
        with output_path.open("a") as out:
            out.write("===== TREE STRUCTURE =====\n")
            out.write(tree_output)
            out.write("\n===== END TREE STRUCTURE =====\n\n")

    # --- File contents ---
    for line in tree_output.splitlines():
        path = Path(line)

        if not path.is_file():
            continue

        if path.resolve() == output_path.resolve():
            continue

        if not args.ignore_off and is_ignored(path, ignore_patterns):
            continue

        if not is_text_file(path):
            continue

        with output_path.open("a") as out:
            out.write(f"===== FILE: {path} =====\n")
            out.write(path.read_text(errors="ignore"))
            out.write(f"\n===== END FILE: {path} =====\n\n")

if __name__ == "__main__":
    main()

===== END FILE: treedump/cli.py =====

===== FILE: treedump.egg-info/entry_points.txt =====
[console_scripts]
treedump = treedump.cli:main

===== END FILE: treedump.egg-info/entry_points.txt =====

===== FILE: treedump.egg-info/PKG-INFO =====
Metadata-Version: 2.4
Name: treedump
Version: 0.1.0
Summary: Dump all text files in a directory tree into a single file
Author: Your Name
Requires-Python: >=3.9
Description-Content-Type: text/markdown
License-File: LICENSE
Dynamic: license-file

# treedump

`treedump` walks a directory tree and produces a single text dump containing:

1. The directory tree structure (first)
2. The contents of all **text files** in that tree (second)

Binary files are ignored.  
The output file itself is never re-ingested.

This tool is designed for:
- code review and audits
- LLM context ingestion
- archiving project snapshots
- inspecting unfamiliar repositories

---

## Installation

Install from PyPI:

    pip install treedump

For development or local testing:

    pip install -e .

---

## Basic usage

Run in any directory:

    treedump

This creates `dump.txt` in the current directory.

---

## Output format

The output is structured and deterministic.

Tree structure is always written first, followed by file contents.

Example:

    ===== TREE STRUCTURE =====
    .
    ./src
    ./src/main.py
    ./README.md
    ===== END TREE STRUCTURE =====

    ===== FILE: src/main.py =====
    <file contents>
    ===== END FILE: src/main.py =====

    ===== FILE: README.md =====
    <file contents>
    ===== END FILE: README.md =====

---

## Ignore behavior (important)

### Default behavior

Ignore rules are determined as follows:

1. If a `.gitignore` file exists in the current directory:
   - Only `.gitignore` rules are used
   - Built-in defaults are NOT applied

2. If no `.gitignore` exists:
   - A safe built-in ignore list is used

The built-in ignore list includes:

- version control and tooling directories  
  `.git/`, `__pycache__/`, `venv/`, `.venv/`, `node_modules/`,  
  `.mypy_cache/`, `.pytest_cache/`, `.idea/`, `.vscode/`

- compiled and noisy artifacts  
  `*.pyc`, `*.log`

- secret-bearing files  
  `.env`, `.env.*`, `*.env`  
  `.secrets`, `.secrets.*`  
  `*.key`, `*.pem`, `*.crt`, `*.p12`, `*.keystore`  
  `id_rsa`, `id_ed25519`, `*.pub`  
  `credentials`, `credentials.*`  
  `.aws/`, `.ssh/`

This makes `treedump` safe by default in non-git directories and predictable inside git repositories.

---

## Ignore options

### Disable all ignore rules

    treedump --ignore-off

When this flag is used:
- all ignore rules are disabled
- binary files are still skipped
- the output file is still excluded

Use with care.

---

### Add ignore files

    treedump --ignore .gitignore custom.ignore

Ignore files use simple glob-style patterns.  
Empty lines and comments (`#`) are ignored.

---

### Add ignore patterns inline

    treedump --ignore-pattern "*.sql" "*.db"

Ignore files and inline patterns are additive unless `--ignore-off` is specified.

---

## Other options

### Change output file name

    treedump --output project_dump.txt

---

### Omit tree structure

    treedump --no-tree

Only file contents will be written.

---

## Requirements

- Python 3.9 or newer
- External commands available in PATH:
  - `tree`
  - `file`

These are standard on most Unix-like systems.

---

## Philosophy

`treedump` follows classic Unix principles:

- structure before content
- text-only by default
- explicit behavior over clever inference
- safe defaults with deliberate escape hatches
- boring, predictable output

It intentionally does less than a full indexing or archival system.

---

## License

MIT

===== END FILE: treedump.egg-info/PKG-INFO =====

===== FILE: treedump.egg-info/SOURCES.txt =====
LICENSE
README.md
pyproject.toml
treedump/__init__.py
treedump/cli.py
treedump.egg-info/PKG-INFO
treedump.egg-info/SOURCES.txt
treedump.egg-info/dependency_links.txt
treedump.egg-info/entry_points.txt
treedump.egg-info/top_level.txt
===== END FILE: treedump.egg-info/SOURCES.txt =====

===== FILE: treedump.egg-info/top_level.txt =====
treedump

===== END FILE: treedump.egg-info/top_level.txt =====

